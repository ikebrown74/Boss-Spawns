{% extends "base.html" %}
{% load boss_filters %}
{% load vote %}

{% block content %}
{% if user.is_authenticated %}

<form action="{% url boss-death server.pk boss.pk %}" method="post">{% csrf_token %}
  {{ death_form.as_p }}
<input type="submit" value="Submit" />
</form>

{% else %}

You're not logged in. <a href="{% url registration_register %}">Register here.</a> or <a href="{% url auth_login %}">Log In.</a>


{% endif %}

<h1>{{ server.name }}</h1>

<h2>{{ boss.name }}</h2>

<h3>{{ boss.zone }}</h3>

<h3>Next Spawn Time: {{ boss|next_spawn:server }}</h3>

<table>
  <thead>
    <tr>
      <th>Votes</th>
      <th>Recent Death Times</th>
    </tr>
  </thead>
  <tbody>
    {% for death in deaths.by_vote %}
    <tr>
      <td>
	{% if user.is_authenticated %}
	{% vote_form death %}
	{% else %}
	<p>Login to vote.</p>
	{% endif %}
	{{ death.votes.count }}
      </td>
      <td>
	{{ death.died_at }}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
